<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shortage Index</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment/moment.min.js"></script>
    <style>
        .chart-container {
            width: 1200px;
            height: 800px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <h1>Shortage Index</h1>
    <p>Welcome to the Shortage Index Webpage!</p>

    <p>Matteo Iacoviello, Dario Caldara and David Yu construct a monthly news-based measure for the U.S. of shortages of industrial goods, energy, food and labor covering the years from 1900 through present.</p>

    <p>Download the CSV file: <a href="shortage_index.csv" download>shortage_index.csv</a></p>
    
    <p>Cite as: Caldara, Dario, Matteo Iacoviello and David Yu (2024), “Measuring Shortages since 1900,” working paper.
    (When using the data, we suggest referring to both the website and the date of download; e.g. “Data downloaded from https://www.matteoiacoviello.com/shortages.htm on Month DD, YYYY”).</p>

    <div class="chart-container">
        <canvas id="shortageChart"></canvas>
    </div>

    <script>
document.addEventListener('DOMContentLoaded', function() {
    Papa.parse('shortage_index.csv', {
        download: true,
        header: true,
        complete: function(results) {
            const shortageData = results.data;
            const columnNames = ['index_all_shortage', 'energy_shortage', 'food_shortage', 'industry_shortage', 'labor_shortage'];

            // Generate dates starting from January 1900
            const startDate = moment('1900-01-01');
            const labels = Array.from({ length: shortageData.length }, (_, index) =>
                startDate.clone().add(index, 'months').format('MMM YYYY')
            );

            // Modified code for the datasets array
            const datasets = columnNames.map((columnName, index) => ({
                label: columnName.replace('_', ' '),
                data: shortageData.map(row => parseFloat(row[columnName])),
                borderColor: (() => {
                    switch (columnName) {
                        case 'index_all_shortage':
                            return 'black';
                        case 'energy_shortage':
                            return 'red';
                        case 'food_shortage':
                            return 'green';
                        case 'industry_shortage':
                            return 'blue';
                        case 'labor_shortage':
                            return 'purple';
                        default:
                            return `hsl(${(index * 60) % 360}, 100%, 50%)`;
                    }
                })(),
                fill: false
            }));

Chart.register(ChartAnnotation);
            
new Chart(document.getElementById('shortageChart'), {
    type: 'line',
    data: {
        labels: labels,
        datasets: datasets
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        title: {
            display: true,
            text: 'Monthly Shortage Index'
        },
        scales: {
            x: {
                display: true,
                title: {
                    display: false
                }
            },
            y: {
                display: true,
                title: {
                    display: true,
                    text: 'Index Value'
                }
            }
        },
        // Add the plugins property with the annotation configuration
        plugins: {
            annotation: {
                annotations: [{
                type: 'label',
                xValue: labels[Math.floor(labels.length * 0.9)], // Position at 90% of the chart width
                yValue: 50, // Adjust the y-value to a suitable position
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                borderColor: 'black',
                borderWidth: 1,
                cornerRadius: 5,
                label: {
                content: 'The shortage index is indexed to 100 in the 1900-2019 period.',
                enabled: true,
                position: 'end',
                textAlign: 'left',
                fontColor: 'white',
                fontStyle: 'normal',
                fontSize: 12,
                xPadding: 10,
                yPadding: 6                    
                    }
                }]
            }
        }
    }
});        }
    });
});
    </script>
    </body>
</html>
